<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Video Downloader - Windows XP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: #008080 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.1"><rect fill="%23008080" width="100" height="100"/><path d="M0 0L100 100M100 0L0 100" stroke="%2300a000" stroke-width="1"/></svg>');
            color: #000;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .desktop {
            width: 100%;
            max-width: 900px;
        }
        
        /* Taskbar */
        .taskbar {
            background: linear-gradient(to bottom, #245edc 0%, #1b4eb9 50%, #0f3b9e 51%, #1b4eb9 100%);
            height: 40px;
            border-top: 1px solid #608fe8;
            display: flex;
            align-items: center;
            padding: 0 10px;
            position: relative;
            z-index: 1000;
        }
        
        .start-button {
            background: linear-gradient(to bottom, #5cb300 0%, #4c9900 50%, #408000 51%, #4c9900 100%);
            border: 1px solid #2d6600;
            color: white;
            padding: 4px 12px;
            font-size: 11px;
            font-weight: bold;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .start-button:hover {
            background: linear-gradient(to bottom, #66cc00 0%, #55aa00 50%, #448800 51%, #55aa00 100%);
        }
        
        .taskbar-time {
            color: white;
            font-size: 11px;
            margin-left: auto;
            padding: 4px 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }
        
        /* Main Window */
        .xp-window {
            background: #ece9d8;
            border: 2px solid #003c74;
            border-radius: 0;
            box-shadow: 4px 4px 12px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        .window-title {
            background: linear-gradient(to right, #0a246a, #a6caf0);
            color: white;
            padding: 6px 10px;
            font-size: 12px;
            font-weight: bold;
            border-bottom: 1px solid #003c74;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .window-controls {
            display: flex;
            gap: 2px;
        }
        
        .window-control {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px solid #808080;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .window-control:hover {
            background: #d4d4d4;
        }
        
        .window-content {
            padding: 20px;
        }
        
        /* XP Form Elements */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 4px;
            color: #000;
        }
        
        .xp-input {
            width: 100%;
            padding: 4px 6px;
            border: 2px inset #c0c0c0;
            background: white;
            font-size: 11px;
            font-family: 'Tahoma', 'Arial', sans-serif;
        }
        
        .xp-input:focus {
            outline: 1px dotted #000;
        }
        
        .xp-select {
            width: 100%;
            padding: 3px;
            border: 2px inset #c0c0c0;
            background: white;
            font-size: 11px;
            font-family: 'Tahoma', 'Arial', sans-serif;
        }
        
        .xp-button {
            background: linear-gradient(to bottom, #f0f0f0, #d4d4d4);
            border: 1px solid #7c7c7c;
            padding: 6px 16px;
            font-size: 11px;
            font-family: 'Tahoma', 'Arial', sans-serif;
            cursor: pointer;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .xp-button:hover {
            background: linear-gradient(to bottom, #e8e8e8, #c8c8c8);
        }
        
        .xp-button:active {
            background: linear-gradient(to bottom, #d4d4d4, #f0f0f0);
            border: 1px inset #7c7c7c;
        }
        
        .xp-button.primary {
            background: linear-gradient(to bottom, #245edc, #1b4eb9);
            color: white;
            border: 1px solid #0f3b9e;
        }
        
        .xp-button.primary:hover {
            background: linear-gradient(to bottom, #2d6bec, #2358c6);
        }
        
        /* Progress Bars */
        .progress-container {
            background: #f1f1f1;
            border: 2px inset #c0c0c0;
            padding: 2px;
            margin: 10px 0;
        }
        
        .progress-bar {
            background: linear-gradient(to bottom, 
                #3c7fb1 0%, 
                #3c7fb1 50%, 
                #2d6b9e 51%, 
                #2d6b9e 100%);
            height: 18px;
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, 
                rgba(255,255,255,0.3) 0%, 
                rgba(255,255,255,0.1) 50%, 
                rgba(0,0,0,0.1) 51%, 
                rgba(0,0,0,0.3) 100%);
            pointer-events: none;
        }
        
        .progress-bar.animated::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.4) 50%, 
                transparent 100%);
            animation: xp-shine 2s infinite;
        }
        
        @keyframes xp-shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .progress-text {
            font-size: 10px;
            color: #000;
            text-align: center;
            margin-top: 4px;
        }
        
        /* Status Sections */
        .status-section {
            display: none;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border: 2px inset #c0c0c0;
        }
        
        .status-section.active {
            display: block;
        }
        
        .status-title {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #000;
        }
        
        .status-stages {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 9px;
        }
        
        .status-stage {
            text-align: center;
            flex: 1;
            padding: 2px;
        }
        
        .status-stage.active {
            color: #000;
            font-weight: bold;
        }
        
        .status-stage.completed::before {
            content: '‚úì ';
            color: green;
        }
        
        /* File Info */
        .file-info {
            background: white;
            border: 2px inset #c0c0c0;
            padding: 10px;
            margin: 10px 0;
            font-size: 10px;
        }
        
        .file-info-row {
            display: flex;
            margin-bottom: 4px;
        }
        
        .file-info-label {
            font-weight: bold;
            width: 80px;
        }
        
        /* Results */
        .result-section {
            display: none;
            margin-top: 15px;
        }
        
        .result-section.active {
            display: block;
        }
        
        .video-preview {
            width: 100%;
            max-width: 400px;
            background: #000;
            margin: 10px 0;
            border: 2px inset #c0c0c0;
        }
        
        .download-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        /* Tabs */
        .xp-tabs {
            display: flex;
            background: #c0c0c0;
            border-bottom: 2px solid #003c74;
            padding: 2px 2px 0 2px;
        }
        
        .xp-tab {
            background: linear-gradient(to bottom, #d4d4d4, #c0c0c0);
            border: 1px solid #808080;
            border-bottom: none;
            padding: 4px 12px;
            font-size: 11px;
            cursor: pointer;
            margin-right: 2px;
            border-radius: 3px 3px 0 0;
        }
        
        .xp-tab.active {
            background: linear-gradient(to bottom, #ece9d8, #d4d4d4);
            border-bottom: 1px solid #ece9d8;
            margin-bottom: -1px;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Message Box */
        .xp-message {
            padding: 10px;
            margin: 10px 0;
            border: 2px inset #c0c0c0;
            background: white;
            font-size: 11px;
        }
        
        .xp-message.error {
            border-color: #ff6b6b;
            background: #ffebeb;
        }
        
        .xp-message.success {
            border-color: #90ee90;
            background: #f0fff0;
        }
        
        /* Loading Animation */
        .xp-loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .xp-loading.active {
            display: block;
        }
        
        .loading-dots {
            display: inline-block;
            font-size: 14px;
        }
        
        .loading-dots::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        /* Grid Layout */
        .xp-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .xp-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="desktop">
        <!-- Main Application Window -->
        <div class="xp-window">
            <div class="window-title">
                <span>üöÄ TikTok Video Downloader - Windows XP Edition</span>
                <div class="window-controls">
                    <div class="window-control">_</div>
                    <div class="window-control">‚ñ°</div>
                    <div class="window-control">√ó</div>
                </div>
            </div>
            
            <div class="xp-tabs">
                <div class="xp-tab active" data-tab="download">Video Download</div>
                <div class="xp-tab" data-tab="settings">Settings</div>
                <div class="xp-tab" data-tab="about">About</div>
            </div>
            
            <!-- Download Tab -->
            <div class="tab-content active" id="download-tab">
                <div class="form-group">
                    <label class="form-label">RapidAPI Key:</label>
                    <input type="text" class="xp-input" id="api-key" placeholder="Enter your RapidAPI key">
                    <div style="font-size: 9px; color: #666; margin-top: 2px;">
                        Get key from: <a href="https://rapidapi.com/yi005/api/tiktok-video-no-watermark2/" target="_blank">RapidAPI</a>
                    </div>
                </div>
                
                <div class="xp-grid">
                    <div class="form-group">
                        <label class="form-label">Download Type:</label>
                        <select class="xp-select" id="endpoint-type">
                            <option value="video">Single Video</option>
                            <option value="feed">User Feed</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="url-group">
                        <label class="form-label">TikTok URL:</label>
                        <input type="text" class="xp-input" id="tiktok-url" placeholder="https://www.tiktok.com/@username/video/1234567890">
                    </div>
                    
                    <div class="form-group" id="username-group" style="display: none;">
                        <label class="form-label">Username:</label>
                        <input type="text" class="xp-input" id="tiktok-username" placeholder="username (without @)">
                    </div>
                </div>
                
                <button class="xp-button primary" id="start-download" style="width: 100%;">
                    üöÄ Start Download
                </button>
                
                <!-- Starting Progress -->
                <div class="status-section" id="starting-section">
                    <div class="status-title">Initializing Download</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="starting-progress"></div>
                    </div>
                    <div class="progress-text" id="starting-text">0% - Preparing download...</div>
                    <div class="status-stages">
                        <div class="status-stage completed" id="stage-1">System Check</div>
                        <div class="status-stage active" id="stage-2">API Connection</div>
                        <div class="status-stage" id="stage-3">URL Validation</div>
                        <div class="status-stage" id="stage-4">Ready</div>
                    </div>
                </div>
                
                <!-- Downloading Progress -->
                <div class="status-section" id="downloading-section">
                    <div class="status-title">Downloading Video</div>
                    <div class="file-info">
                        <div class="file-info-row">
                            <span class="file-info-label">File:</span>
                            <span id="download-filename">tiktok_video.mp4</span>
                        </div>
                        <div class="file-info-row">
                            <span class="file-info-label">Source:</span>
                            <span id="download-source">tiktok.com</span>
                        </div>
                        <div class="file-info-row">
                            <span class="file-info-label">Size:</span>
                            <span id="download-size">Calculating...</span>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar animated" id="download-progress"></div>
                    </div>
                    <div class="progress-text" id="download-text">0% - Starting download...</div>
                    <div class="status-stages">
                        <div class="status-stage completed" id="dl-stage-1">Connected</div>
                        <div class="status-stage active" id="dl-stage-2">Downloading</div>
                        <div class="status-stage" id="dl-stage-3">Processing</div>
                        <div class="status-stage" id="dl-stage-4">Verifying</div>
                    </div>
                    <div class="download-options" style="margin-top: 10px;">
                        <button class="xp-button" id="pause-btn">‚è∏Ô∏è Pause</button>
                        <button class="xp-button" id="cancel-btn">‚ùå Cancel</button>
                    </div>
                </div>
                
                <!-- Processing Progress -->
                <div class="status-section" id="processing-section">
                    <div class="status-title">Processing Video</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="processing-progress"></div>
                    </div>
                    <div class="progress-text" id="processing-text">0% - Removing watermark...</div>
                    <div class="status-stages">
                        <div class="status-stage completed" id="proc-stage-1">Downloaded</div>
                        <div class="status-stage active" id="proc-stage-2">Watermark Removal</div>
                        <div class="status-stage" id="proc-stage-3">Quality Check</div>
                        <div class="status-stage" id="proc-stage-4">Finalizing</div>
                    </div>
                </div>
                
                <!-- Waiting Bar -->
                <div class="status-section" id="waiting-section">
                    <div class="status-title">Finalizing Download</div>
                    <div class="xp-loading" id="final-loading">
                        <div class="loading-dots">Processing</div>
                    </div>
                    <div class="progress-text">Almost complete - Preparing your video for download</div>
                </div>
                
                <!-- Messages -->
                <div class="xp-message" id="error-message" style="display: none;"></div>
                <div class="xp-message success" id="success-message" style="display: none;"></div>
                
                <!-- Results -->
                <div class="result-section" id="result-section">
                    <div class="status-title">üéâ Download Complete!</div>
                    <video class="video-preview" id="video-preview" controls></video>
                    <div class="download-options">
                        <button class="xp-button primary" id="download-nowatermark">
                            ‚¨áÔ∏è Download (No Watermark)
                        </button>
                        <button class="xp-button" id="download-watermark">
                            ‚¨áÔ∏è With Watermark
                        </button>
                        <button class="xp-button" id="download-audio">
                            üéµ Audio Only
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div class="tab-content" id="settings-tab">
                <div class="form-group">
                    <label class="form-label">Download Folder:</label>
                    <div style="display: flex; gap: 5px;">
                        <input type="text" class="xp-input" value="C:\Downloads\TikTok\" readonly>
                        <button class="xp-button">Browse</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Video Quality:</label>
                    <select class="xp-select">
                        <option>Best Available</option>
                        <option>1080p HD</option>
                        <option>720p</option>
                        <option>480p</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" checked> Auto-delete watermarked version
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox"> Show detailed progress
                    </label>
                </div>
                
                <button class="xp-button primary">Save Settings</button>
            </div>
            
            <!-- About Tab -->
            <div class="tab-content" id="about-tab">
                <div class="file-info">
                    <div class="file-info-row">
                        <span class="file-info-label">Application:</span>
                        <span>TikTok Video Downloader</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">Version:</span>
                        <span>Windows XP Edition 1.0</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">API:</span>
                        <span>RapidAPI TikTok No Watermark</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">Developer:</span>
                        <span>Classic Systems</span>
                    </div>
                </div>
                
                <div style="margin-top: 15px; font-size: 10px; color: #666;">
                    <p>This application uses the TikTok Video No Watermark API from RapidAPI to download videos without watermarks.</p>
                    <p style="margin-top: 8px;">¬© 2023 Classic Systems - Windows XP Style Interface</p>
                </div>
            </div>
        </div>
        
        <!-- Taskbar -->
        <div class="taskbar">
            <button class="start-button">
                <span>ü™ü Start</span>
            </button>
            <div class="taskbar-time" id="current-time">Loading...</div>
        </div>
    </div>

    <script>
        class TikTokDownloaderXP {
            constructor() {
                this.apiHost = 'tiktok-video-no-watermark2.p.rapidapi.com';
                this.isDownloading = false;
                this.isPaused = false;
                this.currentSection = null;
                this.progressIntervals = {};
                this.init();
            }

            init() {
                this.bindEvents();
                this.setupTabs();
                this.setupInputToggling();
                this.updateTime();
                setInterval(() => this.updateTime(), 1000);
            }

            bindEvents() {
                // Start download
                document.getElementById('start-download').addEventListener('click', () => this.startDownloadProcess());
                
                // Control buttons
                document.getElementById('pause-btn').addEventListener('click', () => this.togglePause());
                document.getElementById('cancel-btn').addEventListener('click', () => this.cancelDownload());
                
                // Download options
                document.getElementById('download-nowatermark').addEventListener('click', () => this.finalDownload('no-watermark'));
                document.getElementById('download-watermark').addEventListener('click', () => this.finalDownload('watermark'));
                document.getElementById('download-audio').addEventListener('click', () => this.finalDownload('audio'));
                
                // Endpoint type change
                document.getElementById('endpoint-type').addEventListener('change', () => this.setupInputToggling());
            }

            setupTabs() {
                const tabs = document.querySelectorAll('.xp-tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Remove active class from all tabs and contents
                        document.querySelectorAll('.xp-tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        // Add active class to clicked tab and corresponding content
                        tab.classList.add('active');
                        const tabId = tab.getAttribute('data-tab');
                        document.getElementById(`${tabId}-tab`).classList.add('active');
                    });
                });
            }

            setupInputToggling() {
                const endpointType = document.getElementById('endpoint-type').value;
                const urlGroup = document.getElementById('url-group');
                const usernameGroup = document.getElementById('username-group');
                
                if (endpointType === 'video') {
                    urlGroup.style.display = 'block';
                    usernameGroup.style.display = 'none';
                } else {
                    urlGroup.style.display = 'none';
                    usernameGroup.style.display = 'block';
                }
            }

            async startDownloadProcess() {
                const apiKey = document.getElementById('api-key').value.trim();
                const endpointType = document.getElementById('endpoint-type').value;
                
                this.hideMessages();
                this.hideAllSections();
                this.hideResult();
                
                // Validation
                if (!apiKey) {
                    this.showError('Please enter your RapidAPI key');
                    return;
                }

                let url = '';
                if (endpointType === 'video') {
                    url = document.getElementById('tiktok-url').value.trim();
                    if (!url) {
                        this.showError('Please enter a TikTok URL');
                        return;
                    }
                    if (!this.isValidTikTokUrl(url)) {
                        this.showError('Please enter a valid TikTok URL');
                        return;
                    }
                } else {
                    const username = document.getElementById('tiktok-username').value.trim();
                    if (!username) {
                        this.showError('Please enter a TikTok username');
                        return;
                    }
                    url = `https://www.tiktok.com/@${username}`;
                }

                // Update file info
                document.getElementById('download-filename').textContent = this.extractFilename(url);
                document.getElementById('download-source').textContent = new URL(url).hostname;

                // Start the multi-stage download process
                await this.runStartingProcess();
                await this.runDownloadingProcess();
                await this.runProcessingProcess();
                await this.runWaitingProcess();
                await this.finalizeDownload(url, endpointType, apiKey);
            }

            async runStartingProcess() {
                this.showSection('starting-section');
                return new Promise((resolve) => {
                    let progress = 0;
                    const progressBar = document.getElementById('starting-progress');
                    const progressText = document.getElementById('starting-text');
                    
                    const interval = setInterval(() => {
                        if (this.isPaused) return;
                        
                        progress += Math.random() * 8;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            this.updateStage('starting', 4);
                            progressText.textContent = '100% - Ready to download';
                            setTimeout(resolve, 500);
                        } else {
                            this.updateProgress(progressBar, progress);
                            progressText.textContent = `${Math.round(progress)}% - ${this.getStartingStatus(progress)}`;
                            
                            // Update stages
                            if (progress >= 25) this.updateStage('starting', 2);
                            if (progress >= 50) this.updateStage('starting', 3);
                            if (progress >= 75) this.updateStage('starting', 4);
                        }
                    }, 100);
                    
                    this.progressIntervals.starting = interval;
                });
            }

            async runDownloadingProcess() {
                this.showSection('downloading-section');
                return new Promise((resolve) => {
                    let progress = 0;
                    const progressBar = document.getElementById('download-progress');
                    const progressText = document.getElementById('download-text');
                    
                    // Simulate file size calculation
                    const fileSize = Math.floor(Math.random() * 10) + 5;
                    document.getElementById('download-size').textContent = `${fileSize} MB`;
                    
                    const interval = setInterval(() => {
                        if (this.isPaused) return;
                        
                        progress += Math.random() * 4;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            this.updateStage('downloading', 4);
                            progressText.textContent = '100% - Download complete';
                            setTimeout(resolve, 500);
                        } else {
                            this.updateProgress(progressBar, progress);
                            const downloadedMB = (fileSize * progress / 100).toFixed(1);
                            progressText.textContent = `${Math.round(progress)}% - ${downloadedMB} MB of ${fileSize} MB`;
                            
                            // Update stages
                            if (progress >= 25) this.updateStage('downloading', 2);
                            if (progress >= 50) this.updateStage('downloading', 3);
                            if (progress >= 75) this.updateStage('downloading', 4);
                        }
                    }, 150);
                    
                    this.progressIntervals.downloading = interval;
                });
            }

            async runProcessingProcess() {
                this.showSection('processing-section');
                return new Promise((resolve) => {
                    let progress = 0;
                    const progressBar = document.getElementById('processing-progress');
                    const progressText = document.getElementById('processing-text');
                    
                    const interval = setInterval(() => {
                        if (this.isPaused) return;
                        
                        progress += Math.random() * 6;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            this.updateStage('processing', 4);
                            progressText.textContent = '100% - Processing complete';
                            setTimeout(resolve, 500);
                        } else {
                            this.updateProgress(progressBar, progress);
                            progressText.textContent = `${Math.round(progress)}% - ${this.getProcessingStatus(progress)}`;
                            
                            // Update stages
                            if (progress >= 33) this.updateStage('processing', 2);
                            if (progress >= 66) this.updateStage('processing', 3);
                            if (progress >= 90) this.updateStage('processing', 4);
                        }
                    }, 120);
                    
                    this.progressIntervals.processing = interval;
                });
            }

            async runWaitingProcess() {
                this.showSection('waiting-section');
                document.getElementById('final-loading').classList.add('active');
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        document.getElementById('final-loading').classList.remove('active');
                        resolve();
                    }, 2000);
                });
            }

            async finalizeDownload(url, endpointType, apiKey) {
                try {
                    // Simulate API call
                    const videoUrl = 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4';
                    
                    document.getElementById('video-preview').src = videoUrl;
                    this.showResult();
                    this.showSuccess('üéâ Video downloaded successfully! Ready for final download.');
                    
                } catch (error) {
                    this.showError(`Download failed: ${error.message}`);
                }
            }

            // Utility methods
            showSection(sectionId) {
                this.hideAllSections();
                document.getElementById(sectionId).classList.add('active');
                this.currentSection = sectionId;
            }

            hideAllSections() {
                document.querySelectorAll('.status-section').forEach(section => {
                    section.classList.remove('active');
                });
            }

            showResult() {
                document.getElementById('result-section').classList.add('active');
            }

            hideResult() {
                document.getElementById('result-section').classList.remove('active');
            }

            updateProgress(progressBar, percentage) {
                progressBar.style.width = `${percentage}%`;
            }

            updateStage(process, stageNumber) {
                const stages = document.querySelectorAll(`#${process}-section .status-stage`);
                stages.forEach((stage, index) => {
                    stage.classList.remove('active', 'completed');
                    if (index + 1 < stageNumber) {
                        stage.classList.add('completed');
                    } else if (index + 1 === stageNumber) {
                        stage.classList.add('active');
                    }
                });
            }

            togglePause() {
                this.isPaused = !this.isPaused;
                const pauseBtn = document.getElementById('pause-btn');
                pauseBtn.textContent = this.isPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
            }

            cancelDownload() {
                // Clear all intervals
                Object.values(this.progressIntervals).forEach(interval => {
                    if (interval) clearInterval(interval);
                });
                
                this.isDownloading = false;
                this.isPaused = false;
                this.hideAllSections();
                this.showError('Download cancelled by user');
            }

            finalDownload(type) {
                this.showSuccess(`Starting ${type} download...`);
                // In real implementation, this would trigger actual download
            }

            getStartingStatus(progress) {
                if (progress < 25) return 'Checking system...';
                if (progress < 50) return 'Connecting to API...';
                if (progress < 75) return 'Validating URL...';
                return 'Finalizing setup...';
            }

            getProcessingStatus(progress) {
                if (progress < 33) return 'Removing watermark...';
                if (progress < 66) return 'Optimizing quality...';
                if (progress < 90) return 'Final processing...';
                return 'Complete';
            }

            extractFilename(url) {
                try {
                    const urlObj = new URL(url);
                    const pathParts = urlObj.pathname.split('/');
                    const videoId = pathParts[pathParts.length - 1];
                    return `tiktok_${videoId || 'video'}.mp4`;
                } catch {
                    return 'tiktok_video.mp4';
                }
            }

            showError(message) {
                const element = document.getElementById('error-message');
                element.textContent = message;
                element.className = 'xp-message error';
                element.style.display = 'block';
            }

            showSuccess(message) {
                const element = document.getElementById('success-message');
                element.textContent = message;
                element.className = 'xp-message success';
                element.style.display = 'block';
            }

            hideMessages() {
                document.getElementById('error-message').style.display = 'none';
                document.getElementById('success-message').style.display = 'none';
            }

            updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', { 
                    hour12: true, 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('current-time').textContent = timeString;
            }

            isValidTikTokUrl(url) {
                const tiktokRegex = /https?:\/\/(www\.)?tiktok\.com\/.+/;
                return tiktokRegex.test(url);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new TikTokDownloaderXP();
            
            // Add sample data for demo
            document.getElementById('tiktok-url').value = 'https://www.tiktok.com/@tiktok/video/1234567890';
            document.getElementById('tiktok-username').value = 'tiktok';
            document.getElementById('api-key').value = 'demo_api_key_12345';
        });
    </script>
</body>
</html>
