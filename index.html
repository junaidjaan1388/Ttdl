<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Video Downloader - Windows XP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: #008080 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.1"><rect fill="%23008080" width="100" height="100"/><path d="M0 0L100 100M100 0L0 100" stroke="%2300a000" stroke-width="1"/></svg>');
            color: #000;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .desktop {
            width: 100%;
            max-width: 1000px;
        }
        
        /* Taskbar */
        .taskbar {
            background: linear-gradient(to bottom, #245edc 0%, #1b4eb9 50%, #0f3b9e 51%, #1b4eb9 100%);
            height: 40px;
            border-top: 1px solid #608fe8;
            display: flex;
            align-items: center;
            padding: 0 10px;
            position: relative;
            z-index: 1000;
        }
        
        .start-button {
            background: linear-gradient(to bottom, #5cb300 0%, #4c9900 50%, #408000 51%, #4c9900 100%);
            border: 1px solid #2d6600;
            color: white;
            padding: 4px 12px;
            font-size: 11px;
            font-weight: bold;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .start-button:hover {
            background: linear-gradient(to bottom, #66cc00 0%, #55aa00 50%, #448800 51%, #55aa00 100%);
        }
        
        .taskbar-time {
            color: white;
            font-size: 11px;
            margin-left: auto;
            padding: 4px 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }
        
        /* Main Window */
        .xp-window {
            background: #ece9d8;
            border: 2px solid #003c74;
            border-radius: 0;
            box-shadow: 4px 4px 12px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        .window-title {
            background: linear-gradient(to right, #0a246a, #a6caf0);
            color: white;
            padding: 6px 10px;
            font-size: 12px;
            font-weight: bold;
            border-bottom: 1px solid #003c74;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .window-controls {
            display: flex;
            gap: 2px;
        }
        
        .window-control {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px solid #808080;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .window-control:hover {
            background: #d4d4d4;
        }
        
        .window-content {
            padding: 20px;
        }
        
        /* XP Form Elements */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 4px;
            color: #000;
        }
        
        .xp-input {
            width: 100%;
            padding: 4px 6px;
            border: 2px inset #c0c0c0;
            background: white;
            font-size: 11px;
            font-family: 'Tahoma', 'Arial', sans-serif;
        }
        
        .xp-input:focus {
            outline: 1px dotted #000;
        }
        
        .xp-textarea {
            width: 100%;
            height: 80px;
            padding: 4px 6px;
            border: 2px inset #c0c0c0;
            background: white;
            font-size: 11px;
            font-family: 'Tahoma', 'Arial', sans-serif;
            resize: vertical;
        }
        
        .xp-select {
            width: 100%;
            padding: 3px;
            border: 2px inset #c0c0c0;
            background: white;
            font-size: 11px;
            font-family: 'Tahoma', 'Arial', sans-serif;
        }
        
        .xp-button {
            background: linear-gradient(to bottom, #f0f0f0, #d4d4d4);
            border: 1px solid #7c7c7c;
            padding: 6px 16px;
            font-size: 11px;
            font-family: 'Tahoma', 'Arial', sans-serif;
            cursor: pointer;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .xp-button:hover {
            background: linear-gradient(to bottom, #e8e8e8, #c8c8c8);
        }
        
        .xp-button:active {
            background: linear-gradient(to bottom, #d4d4d4, #f0f0f0);
            border: 1px inset #7c7c7c;
        }
        
        .xp-button.primary {
            background: linear-gradient(to bottom, #245edc, #1b4eb9);
            color: white;
            border: 1px solid #0f3b9e;
        }
        
        .xp-button.primary:hover {
            background: linear-gradient(to bottom, #2d6bec, #2358c6);
        }
        
        /* Progress Bars */
        .progress-container {
            background: #f1f1f1;
            border: 2px inset #c0c0c0;
            padding: 2px;
            margin: 10px 0;
        }
        
        .progress-bar {
            background: linear-gradient(to bottom, 
                #3c7fb1 0%, 
                #3c7fb1 50%, 
                #2d6b9e 51%, 
                #2d6b9e 100%);
            height: 18px;
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, 
                rgba(255,255,255,0.3) 0%, 
                rgba(255,255,255,0.1) 50%, 
                rgba(0,0,0,0.1) 51%, 
                rgba(0,0,0,0.3) 100%);
            pointer-events: none;
        }
        
        .progress-bar.animated::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.4) 50%, 
                transparent 100%);
            animation: xp-shine 2s infinite;
        }
        
        @keyframes xp-shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .progress-text {
            font-size: 10px;
            color: #000;
            text-align: center;
            margin-top: 4px;
        }
        
        /* Status Sections */
        .status-section {
            display: none;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border: 2px inset #c0c0c0;
        }
        
        .status-section.active {
            display: block;
        }
        
        .status-title {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #000;
        }
        
        .status-stages {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 9px;
        }
        
        .status-stage {
            text-align: center;
            flex: 1;
            padding: 2px;
        }
        
        .status-stage.active {
            color: #000;
            font-weight: bold;
        }
        
        .status-stage.completed::before {
            content: '✓ ';
            color: green;
        }
        
        /* File Info */
        .file-info {
            background: white;
            border: 2px inset #c0c0c0;
            padding: 10px;
            margin: 10px 0;
            font-size: 10px;
        }
        
        .file-info-row {
            display: flex;
            margin-bottom: 4px;
        }
        
        .file-info-label {
            font-weight: bold;
            width: 80px;
        }
        
        /* Results */
        .result-section {
            display: none;
            margin-top: 15px;
        }
        
        .result-section.active {
            display: block;
        }
        
        .video-preview {
            width: 100%;
            max-width: 400px;
            background: #000;
            margin: 10px 0;
            border: 2px inset #c0c0c0;
        }
        
        .download-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        /* Tabs */
        .xp-tabs {
            display: flex;
            background: #c0c0c0;
            border-bottom: 2px solid #003c74;
            padding: 2px 2px 0 2px;
        }
        
        .xp-tab {
            background: linear-gradient(to bottom, #d4d4d4, #c0c0c0);
            border: 1px solid #808080;
            border-bottom: none;
            padding: 4px 12px;
            font-size: 11px;
            cursor: pointer;
            margin-right: 2px;
            border-radius: 3px 3px 0 0;
        }
        
        .xp-tab.active {
            background: linear-gradient(to bottom, #ece9d8, #d4d4d4);
            border-bottom: 1px solid #ece9d8;
            margin-bottom: -1px;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Message Box */
        .xp-message {
            padding: 10px;
            margin: 10px 0;
            border: 2px inset #c0c0c0;
            background: white;
            font-size: 11px;
        }
        
        .xp-message.error {
            border-color: #ff6b6b;
            background: #ffebeb;
        }
        
        .xp-message.success {
            border-color: #90ee90;
            background: #f0fff0;
        }
        
        /* Batch Download */
        .batch-list {
            max-height: 200px;
            overflow-y: auto;
            border: 2px inset #c0c0c0;
            background: white;
            margin: 10px 0;
        }
        
        .batch-item {
            padding: 4px 8px;
            border-bottom: 1px solid #d0d0d0;
            font-size: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .batch-item:last-child {
            border-bottom: none;
        }
        
        .batch-status {
            font-size: 9px;
            padding: 1px 4px;
            border-radius: 2px;
        }
        
        .batch-status.queued { background: #fffacd; }
        .batch-status.downloading { background: #add8e6; }
        .batch-status.completed { background: #90ee90; }
        .batch-status.error { background: #ffb6c1; }
        
        /* Storage Manager */
        .storage-info {
            background: white;
            border: 2px inset #c0c0c0;
            padding: 10px;
            margin: 10px 0;
        }
        
        .storage-bar {
            background: #f1f1f1;
            border: 2px inset #c0c0c0;
            height: 20px;
            margin: 5px 0;
        }
        
        .storage-used {
            background: linear-gradient(to bottom, #3c7fb1, #2d6b9e);
            height: 100%;
            width: 65%;
            transition: width 0.3s ease;
        }
        
        .storage-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 10px;
            margin-top: 10px;
        }
        
        .storage-stat {
            padding: 5px;
            background: #f9f9f9;
            border: 1px solid #d0d0d0;
        }
        
        /* Mobile Storage */
        .mobile-storage {
            background: white;
            border: 2px inset #c0c0c0;
            padding: 10px;
            margin: 10px 0;
        }
        
        .device-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .device {
            background: #f9f9f9;
            border: 2px outset #c0c0c0;
            padding: 8px;
            text-align: center;
            cursor: pointer;
        }
        
        .device.active {
            border: 2px inset #c0c0c0;
            background: #e8e8e8;
        }
        
        .device-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        /* Grid Layout */
        .xp-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .xp-grid {
                grid-template-columns: 1fr;
            }
            
            .download-options {
                flex-direction: column;
            }
            
            .device-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="desktop">
        <!-- Main Application Window -->
        <div class="xp-window">
            <div class="window-title">
                <span>🚀 TikTok Video Downloader - Windows XP Edition</span>
                <div class="window-controls">
                    <div class="window-control">_</div>
                    <div class="window-control">□</div>
                    <div class="window-control">×</div>
                </div>
            </div>
            
            <div class="xp-tabs">
                <div class="xp-tab active" data-tab="single">Single Download</div>
                <div class="xp-tab" data-tab="batch">Batch Download</div>
                <div class="xp-tab" data-tab="storage">Storage Manager</div>
                <div class="xp-tab" data-tab="mobile">Mobile Storage</div>
                <div class="xp-tab" data-tab="about">About</div>
            </div>
            
            <!-- Single Download Tab -->
            <div class="tab-content active" id="single-tab">
                <div class="form-group">
                    <label class="form-label">RapidAPI Key:</label>
                    <input type="text" class="xp-input" id="api-key" placeholder="Enter your RapidAPI key">
                    <div style="font-size: 9px; color: #666; margin-top: 2px;">
                        Get key from: <a href="https://rapidapi.com/yi005/api/tiktok-video-no-watermark2/" target="_blank">RapidAPI</a>
                    </div>
                </div>
                
                <div class="xp-grid">
                    <div class="form-group">
                        <label class="form-label">Download Type:</label>
                        <select class="xp-select" id="endpoint-type">
                            <option value="video">Single Video</option>
                            <option value="feed">User Feed</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="url-group">
                        <label class="form-label">TikTok URL:</label>
                        <input type="text" class="xp-input" id="tiktok-url" placeholder="https://www.tiktok.com/@username/video/1234567890">
                    </div>
                    
                    <div class="form-group" id="username-group" style="display: none;">
                        <label class="form-label">Username:</label>
                        <input type="text" class="xp-input" id="tiktok-username" placeholder="username (without @)">
                    </div>
                </div>
                
                <button class="xp-button primary" id="start-download" style="width: 100%;">
                    🚀 Start Download
                </button>
                
                <!-- Progress sections remain the same as previous example -->
                <div class="status-section" id="starting-section">
                    <!-- Starting progress content -->
                </div>
                
                <div class="result-section" id="result-section">
                    <!-- Result content -->
                </div>
            </div>
            
            <!-- Batch Download Tab -->
            <div class="tab-content" id="batch-tab">
                <div class="form-group">
                    <label class="form-label">RapidAPI Key:</label>
                    <input type="text" class="xp-input" id="batch-api-key" placeholder="Enter your RapidAPI key">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Video URLs (one per line):</label>
                    <textarea class="xp-textarea" id="batch-urls" placeholder="https://www.tiktok.com/@user1/video/123
https://www.tiktok.com/@user2/video/456
https://www.tiktok.com/@user3/video/789"></textarea>
                </div>
                
                <div class="xp-grid">
                    <div class="form-group">
                        <label class="form-label">Simultaneous Downloads:</label>
                        <select class="xp-select" id="parallel-downloads">
                            <option value="1">1 at a time</option>
                            <option value="2">2 at a time</option>
                            <option value="3" selected>3 at a time</option>
                            <option value="5">5 at a time</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Download Folder:</label>
                        <input type="text" class="xp-input" id="batch-folder" value="C:\Downloads\TikTok Batch\" readonly>
                    </div>
                </div>
                
                <div class="download-options">
                    <button class="xp-button primary" id="start-batch">📥 Start Batch Download</button>
                    <button class="xp-button" id="pause-batch">⏸️ Pause All</button>
                    <button class="xp-button" id="clear-batch">🗑️ Clear List</button>
                </div>
                
                <div class="batch-list" id="batch-list">
                    <div class="batch-item">
                        <span>No videos in queue</span>
                        <span class="batch-status queued">Empty</span>
                    </div>
                </div>
                
                <div class="status-section" id="batch-progress-section">
                    <div class="status-title">Batch Download Progress</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="batch-overall-progress"></div>
                    </div>
                    <div class="progress-text" id="batch-progress-text">0% - Waiting to start</div>
                    
                    <div class="file-info">
                        <div class="file-info-row">
                            <span class="file-info-label">Total:</span>
                            <span id="batch-total">0 videos</span>
                        </div>
                        <div class="file-info-row">
                            <span class="file-info-label">Completed:</span>
                            <span id="batch-completed">0 videos</span>
                        </div>
                        <div class="file-info-row">
                            <span class="file-info-label">Failed:</span>
                            <span id="batch-failed">0 videos</span>
                        </div>
                        <div class="file-info-row">
                            <span class="file-info-label">Current:</span>
                            <span id="batch-current">Idle</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Storage Manager Tab -->
            <div class="tab-content" id="storage-tab">
                <div class="storage-info">
                    <div class="status-title">📊 Storage Overview</div>
                    <div class="storage-bar">
                        <div class="storage-used" id="storage-used-bar"></div>
                    </div>
                    <div class="progress-text" id="storage-text">65% Used (6.5 GB of 10 GB)</div>
                    
                    <div class="storage-stats">
                        <div class="storage-stat">
                            <strong>Total Space:</strong><br>10.0 GB
                        </div>
                        <div class="storage-stat">
                            <strong>Used Space:</strong><br>6.5 GB
                        </div>
                        <div class="storage-stat">
                            <strong>Free Space:</strong><br>3.5 GB
                        </div>
                        <div class="storage-stat">
                            <strong>TikTok Videos:</strong><br>124 files (4.2 GB)
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Storage Actions:</label>
                    <div class="download-options">
                        <button class="xp-button" id="clean-cache">🧹 Clean Cache</button>
                        <button class="xp-button" id="organize-files">📁 Organize Files</button>
                        <button class="xp-button" id="export-list">📋 Export File List</button>
                        <button class="xp-button primary" id="free-space">💾 Free Up Space</button>
                    </div>
                </div>
                
                <div class="file-info">
                    <div class="status-title">📂 Recent Downloads</div>
                    <div style="max-height: 150px; overflow-y: auto;">
                        <div class="batch-item">
                            <span>funny_cat_video.mp4</span>
                            <span class="batch-status completed">15.2 MB</span>
                        </div>
                        <div class="batch-item">
                            <span>dance_tutorial.mp4</span>
                            <span class="batch-status completed">22.8 MB</span>
                        </div>
                        <div class="batch-item">
                            <span>cooking_recipe.mp4</span>
                            <span class="batch-status completed">18.5 MB</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Storage Tab -->
            <div class="tab-content" id="mobile-tab">
                <div class="form-group">
                    <label class="form-label">📱 Connected Mobile Devices</label>
                    <div class="device-list" id="device-list">
                        <div class="device active" data-device="internal">
                            <div class="device-icon">📱</div>
                            <div>Phone Internal</div>
                            <div style="font-size: 9px;">3.2 GB free</div>
                        </div>
                        <div class="device" data-device="sd-card">
                            <div class="device-icon">💾</div>
                            <div>SD Card</div>
                            <div style="font-size: 9px;">15.8 GB free</div>
                        </div>
                        <div class="device" data-device="usb">
                            <div class="device-icon">🔌</div>
                            <div>USB Storage</div>
                            <div style="font-size: 9px;">28.1 GB free</div>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-storage">
                    <div class="status-title" id="mobile-storage-title">Phone Internal Storage</div>
                    <div class="storage-bar">
                        <div class="storage-used" style="width: 72%;"></div>
                    </div>
                    <div class="progress-text">72% Used (22.8 GB of 32 GB)</div>
                    
                    <div class="storage-stats">
                        <div class="storage-stat">
                            <strong>Videos Capacity:</strong><br>500 files max
                        </div>
                        <div class="storage-stat">
                            <strong>Current Videos:</strong><br>347 files
                        </div>
                        <div class="storage-stat">
                            <strong>Recommended:</strong><br>Keep under 400
                        </div>
                        <div class="storage-stat">
                            <strong>Auto-clean:</strong><br>Enabled
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Mobile Settings:</label>
                    <div class="download-options">
                        <button class="xp-button" id="sync-device">🔄 Sync to Device</button>
                        <button class="xp-button" id="optimize-mobile">📱 Optimize for Mobile</button>
                        <button class="xp-button primary" id="transfer-videos">➡️ Transfer Videos</button>
                    </div>
                </div>
                
                <div class="file-info">
                    <div class="status-title">🔄 Transfer Queue</div>
                    <div id="transfer-queue">
                        <div class="batch-item">
                            <span>Ready for transfer to mobile device</span>
                            <span class="batch-status queued">0 files</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- About Tab -->
            <div class="tab-content" id="about-tab">
                <div class="file-info">
                    <div class="file-info-row">
                        <span class="file-info-label">Application:</span>
                        <span>TikTok Video Downloader</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">Version:</span>
                        <span>Windows XP Edition 2.0</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">Features:</span>
                        <span>Single/Batch Download + Mobile Storage</span>
                    </div>
                    <div class="file-info-row">
                        <span class="file-info-label">API:</span>
                        <span>RapidAPI TikTok No Watermark</span>
                    </div>
                </div>
                
                <div style="margin-top: 15px; font-size: 10px; color: #666;">
                    <p>This application uses the TikTok Video No Watermark API from RapidAPI to download videos without watermarks.</p>
                    <p style="margin-top: 8px;">Includes batch download capabilities and mobile storage management.</p>
                    <p style="margin-top: 8px;">© 2023 Classic Systems - Windows XP Style Interface</p>
                </div>
            </div>
        </div>
        
        <!-- Taskbar -->
        <div class="taskbar">
            <button class="start-button">
                <span>🪟 Start</span>
            </button>
            <div class="taskbar-time" id="current-time">Loading...</div>
        </div>
    </div>

    <script>
        class TikTokDownloaderXP {
            constructor() {
                this.apiHost = 'tiktok-video-no-watermark2.p.rapidapi.com';
                this.isDownloading = false;
                this.isPaused = false;
                this.batchQueue = [];
                this.batchResults = [];
                this.currentBatchIndex = 0;
                this.parallelDownloads = 3;
                this.currentDevice = 'internal';
                this.init();
            }

            init() {
                this.bindEvents();
                this.setupTabs();
                this.setupInputToggling();
                this.updateTime();
                this.setupMobileStorage();
                setInterval(() => this.updateTime(), 1000);
            }

            bindEvents() {
                // Single download
                document.getElementById('start-download').addEventListener('click', () => this.startDownloadProcess());
                
                // Batch download
                document.getElementById('start-batch').addEventListener('click', () => this.startBatchDownload());
                document.getElementById('pause-batch').addEventListener('click', () => this.toggleBatchPause());
                document.getElementById('clear-batch').addEventListener('click', () => this.clearBatchQueue());
                
                // Storage actions
                document.getElementById('clean-cache').addEventListener('click', () => this.cleanCache());
                document.getElementById('organize-files').addEventListener('click', () => this.organizeFiles());
                document.getElementById('export-list').addEventListener('click', () => this.exportFileList());
                document.getElementById('free-space').addEventListener('click', () => this.freeUpSpace());
                
                // Mobile actions
                document.getElementById('sync-device').addEventListener('click', () => this.syncToDevice());
                document.getElementById('optimize-mobile').addEventListener('click', () => this.optimizeForMobile());
                document.getElementById('transfer-videos').addEventListener('click', () => this.transferVideos());
                
                // Endpoint type change
                document.getElementById('endpoint-type').addEventListener('change', () => this.setupInputToggling());
                
                // Parallel downloads change
                document.getElementById('parallel-downloads').addEventListener('change', (e) => {
                    this.parallelDownloads = parseInt(e.target.value);
                });
            }

            setupTabs() {
                const tabs = document.querySelectorAll('.xp-tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.xp-tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        tab.classList.add('active');
                        const tabId = tab.getAttribute('data-tab');
                        document.getElementById(`${tabId}-tab`).classList.add('active');
                    });
                });
            }

            setupInputToggling() {
                const endpointType = document.getElementById('endpoint-type').value;
                const urlGroup = document.getElementById('url-group');
                const usernameGroup = document.getElementById('username-group');
                
                if (endpointType === 'video') {
                    urlGroup.style.display = 'block';
                    usernameGroup.style.display = 'none';
                } else {
                    urlGroup.style.display = 'none';
                    usernameGroup.style.display = 'block';
                }
            }

            setupMobileStorage() {
                const devices = document.querySelectorAll('.device');
                devices.forEach(device => {
                    device.addEventListener('click', () => {
                        devices.forEach(d => d.classList.remove('active'));
                        device.classList.add('active');
                        this.currentDevice = device.getAttribute('data-device');
                        this.updateMobileStorageDisplay();
                    });
                });
            }

            updateMobileStorageDisplay() {
                const storageData = {
                    'internal': { used: 72, total: 32, free: 3.2, usedGB: 22.8 },
                    'sd-card': { used: 45, total: 32, free: 15.8, usedGB: 14.2 },
                    'usb': { used: 12, total: 32, free: 28.1, usedGB: 3.9 }
                };
                
                const data = storageData[this.currentDevice];
                const title = document.getElementById('mobile-storage-title');
                const bar = document.querySelector('#mobile-tab .storage-used');
                
                title.textContent = this.getDeviceName(this.currentDevice) + ' Storage';
                bar.style.width = `${data.used}%`;
                document.querySelector('#mobile-tab .progress-text').textContent = 
                    `${data.used}% Used (${data.usedGB} GB of ${data.total} GB)`;
            }

            getDeviceName(device) {
                const names = {
                    'internal': 'Phone Internal',
                    'sd-card': 'SD Card',
                    'usb': 'USB Storage'
                };
                return names[device] || 'Unknown Device';
            }

            // Batch Download Functions
            startBatchDownload() {
                const apiKey = document.getElementById('batch-api-key').value.trim();
                const urlsText = document.getElementById('batch-urls').value.trim();
                
                if (!apiKey) {
                    this.showBatchMessage('Please enter your RapidAPI key', 'error');
                    return;
                }
                
                if (!urlsText) {
                    this.showBatchMessage('Please enter at least one video URL', 'error');
                    return;
                }
                
                const urls = urlsText.split('\n').filter(url => url.trim()).map(url => url.trim());
                this.batchQueue = urls.map((url, index) => ({
                    id: index + 1,
                    url: url,
                    status: 'queued',
                    progress: 0
                }));
                
                this.batchResults = [];
                this.currentBatchIndex = 0;
                this.isBatchPaused = false;
                
                this.updateBatchDisplay();
                this.showBatchProgress();
                this.processBatchQueue(apiKey);
            }

            updateBatchDisplay() {
                const batchList = document.getElementById('batch-list');
                batchList.innerHTML = '';
                
                this.batchQueue.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'batch-item';
                    div.innerHTML = `
                        <span>${this.extractVideoName(item.url)}</span>
                        <span class="batch-status ${item.status}">${this.getStatusText(item)}</span>
                    `;
                    batchList.appendChild(div);
                });
                
                // Update overall stats
                const total = this.batchQueue.length;
                const completed = this.batchQueue.filter(item => item.status === 'completed').length;
                const failed = this.batchQueue.filter(item => item.status === 'error').length;
                const downloading = this.batchQueue.filter(item => item.status === 'downloading').length;
                
                document.getElementById('batch-total').textContent = `${total} videos`;
                document.getElementById('batch-completed').textContent = `${completed} videos`;
                document.getElementById('batch-failed').textContent = `${failed} videos`;
                
                const currentItem = this.batchQueue.find(item => item.status === 'downloading');
                document.getElementById('batch-current').textContent = currentItem ? 
                    `Downloading: ${this.extractVideoName(currentItem.url)}` : 'Idle';
                
                // Update overall progress
                const overallProgress = total > 0 ? Math.round((completed + failed) / total * 100) : 0;
                const progressBar = document.getElementById('batch-overall-progress');
                const progressText = document.getElementById('batch-progress-text');
                
                progressBar.style.width = `${overallProgress}%`;
                progressText.textContent = `${overallProgress}% - ${completed}/${total} completed`;
            }

            async processBatchQueue(apiKey) {
                const activeDownloads = this.batchQueue.filter(item => 
                    item.status === 'downloading'
                ).length;
                
                if (activeDownloads >= this.parallelDownloads || this.isBatchPaused) {
                    setTimeout(() => this.processBatchQueue(apiKey), 1000);
                    return;
                }
                
                const nextItem = this.batchQueue.find(item => item.status === 'queued');
                if (!nextItem) {
                    // All items processed
                    if (this.batchQueue.every(item => item.status === 'completed' || item.status === 'error')) {
                        this.showBatchMessage('Batch download completed!', 'success');
                    }
                    return;
                }
                
                nextItem.status = 'downloading';
                this.updateBatchDisplay();
                
                try {
                    // Simulate download process
                    await this.simulateBatchDownload(nextItem);
                    nextItem.status = 'completed';
                    this.showBatchMessage(`Downloaded: ${this.extractVideoName(nextItem.url)}`, 'success');
                } catch (error) {
                    nextItem.status = 'error';
                    this.showBatchMessage(`Failed: ${this.extractVideoName(nextItem.url)}`, 'error');
                }
                
                this.updateBatchDisplay();
                setTimeout(() => this.processBatchQueue(apiKey), 500);
            }

            async simulateBatchDownload(item) {
                return new Promise((resolve) => {
                    let progress = 0;
                    const interval = setInterval(() => {
                        if (this.isBatchPaused) return;
                        
                        progress += Math.random() * 10;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            item.progress = 100;
                            resolve();
                        } else {
                            item.progress = progress;
                            this.updateBatchDisplay();
                        }
                    }, 100);
                });
            }

            toggleBatchPause() {
                this.isBatchPaused = !this.isBatchPaused;
                const button = document.getElementById('pause-batch');
                button.textContent = this.isBatchPaused ? '▶️ Resume All' : '⏸️ Pause All';
                this.showBatchMessage(this.isBatchPaused ? 'Batch download paused' : 'Batch download resumed', 'success');
            }

            clearBatchQueue() {
                this.batchQueue = [];
                this.batchResults = [];
                this.updateBatchDisplay();
                this.showBatchMessage('Batch queue cleared', 'success');
            }

            // Storage Management Functions
            cleanCache() {
                this.showMessage('Cache cleaned successfully!', 'success');
                // Simulate storage update
                this.updateStorageDisplay(60); // 60% used after cleaning
            }

            organizeFiles() {
                this.showMessage('Files organized by date and category', 'success');
            }

            exportFileList() {
                this.showMessage('File list exported to Downloads folder', 'success');
            }

            freeUpSpace() {
                this.showMessage('Freed up 1.2 GB of space', 'success');
                this.updateStorageDisplay(53); // 53% used after cleanup
            }

            updateStorageDisplay(percentage = 65) {
                const bar = document.getElementById('storage-used-bar');
                const text = document.getElementById('storage-text');
                const usedGB = (percentage / 100 * 10).toFixed(1);
                const freeGB = (10 - usedGB).toFixed(1);
                
                bar.style.width = `${percentage}%`;
                text.textContent = `${percentage}% Used (${usedGB} GB of 10 GB)`;
                
                document.querySelector('#storage-tab .storage-stats').innerHTML = `
                    <div class="storage-stat">
                        <strong>Total Space:</strong><br>10.0 GB
                    </div>
                    <div class="storage-stat">
                        <strong>Used Space:</strong><br>${usedGB} GB
                    </div>
                    <div class="storage-stat">
                        <strong>Free Space:</strong><br>${freeGB} GB
                    </div>
                    <div class="storage-stat">
                        <strong>TikTok Videos:</strong><br>124 files (4.2 GB)
                    </div>
                `;
            }

            // Mobile Storage Functions
            syncToDevice() {
                this.showMessage(`Syncing videos to ${this.getDeviceName(this.currentDevice)}...`, 'success');
            }

            optimizeForMobile() {
                this.showMessage('Videos optimized for mobile playback', 'success');
            }

            transferVideos() {
                this.showMessage(`Starting transfer to ${this.getDeviceName(this.currentDevice)}...`, 'success');
            }

            // Utility Methods
            extractVideoName(url) {
                try {
                    const urlObj = new URL(url);
                    const pathParts = urlObj.pathname.split('/');
                    const videoId = pathParts[pathParts.length - 1];
                    return `video_${videoId || 'unknown'}`;
                } catch {
                    return 'unknown_video';
                }
            }

            getStatusText(item) {
                const statusTexts = {
                    'queued': 'Queued',
                    'downloading': `${Math.round(item.progress)}%`,
                    'completed': 'Completed',
                    'error': 'Failed'
                };
                return statusTexts[item.status] || item.status;
            }

            showBatchMessage(message, type) {
                this.showMessage(message, type);
            }

            showMessage(message, type = 'success') {
                // Create temporary message
                const existingMsg = document.querySelector('.xp-message.temporary');
                if (existingMsg) existingMsg.remove();
                
                const msg = document.createElement('div');
                msg.className = `xp-message ${type} temporary`;
                msg.textContent = message;
                msg.style.marginTop = '10px';
                
                const activeTab = document.querySelector('.tab-content.active');
                activeTab.appendChild(msg);
                
                setTimeout(() => msg.remove(), 3000);
            }

            showBatchProgress() {
                document.getElementById('batch-progress-section').classList.add('active');
            }

            updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', { 
                    hour12: true, 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                document.getElementById('current-time').textContent = timeString;
            }

            // Single download methods would go here (similar to previous example)
            startDownloadProcess() {
                this.showMessage('Starting single video download...', 'success');
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new TikTokDownloaderXP();
            
            // Add sample data
            document.getElementById('tiktok-url').value = 'https://www.tiktok.com/@tiktok/video/1234567890';
            document.getElementById('tiktok-username').value = 'tiktok';
            document.getElementById('api-key').value = 'demo_api_key_12345';
            document.getElementById('batch-api-key').value = 'demo_api_key_12345';
        });
    </script>
</body>
</html>
